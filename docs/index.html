<script src="https://unpkg.com/vue"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
<div id="app" class="row form-horizontal container">
    <div class="form-group">
        <H1 class="col-xs-offset-2 col-lg-offset-2">MA-SIB free spots checker</H1> 
    </div>
    <div class="form-group">
        <a type="button" class="btn btn-default col-xs-offset-2 col-xs-3" aria-label="Left Align" href="https://github.com/YossiCohen/MA-SIB">
         <span class="fa fa-github fa-lg" aria-hidden="true"></span> Get the source on GitHub
        </a>
    </div>

    <div class="form-group">
        <br/>
        <label for="dim" class="col-xs-offset-2 col-xs-3 control-label">Hypercube dimentions:</label>
        <div class="col-xs-5">
            <input id='dim' v-model.number="dim" type="number" class="form-control" /> </div>
    </div>
    <div class="form-group">
        <label for="snakeSpread" class="col-xs-offset-2 col-xs-3 control-label">Intra-Snake spread:</label>
        <div class="col-xs-5">
            <input id='snakeSpread' v-model.number="snakeSpread" type="number" class="form-control" /> </div>
    </div>
    <div class="form-group">
        <label for="boxSpread" class="col-xs-offset-2 col-xs-3 control-label">Inter-Snake spread (box):</label>
        <div class="col-xs-5">
            <input id='boxSpread' v-model.number="boxSpread" type="number" class="form-control" /> </div>
    </div>
    <div class="form-group">
        <label for="sequance" class="col-xs-offset-2 col-xs-3 control-label"> Sequences (internal separated by -, external separated by |):
            <br/> <small>I.E: |0-1-3|422-486-230| for two snakes, use decimal - not binary!</small> </label>
        <div class="col-xs-5">
            <textarea id='sequance' v-model="sequance" class="form-control"></textarea>
        </div>
    </div>
    <div class="form-group">
        <button v-on:click="calculateFreeSpots" class="btn btn-primary col-xs-offset-2 col-xs-3">Calculate!</button>
         <div class="col-xs-5">
        <label>Calculate empty locations &amp; basic validation of snakes - i.e. Dimentions &amp; intra-snake hamming distance is 1</label>
        </div>
    </div>
    <br/>
    <br/>
    <div class="row">
        <div class="col-xs-offset-2 col-xs-8">
            <br/> Snakes Locations: {{snakeSpot.length}}
            <br/> {{snakeSpot}}
            <br/>
            <br/> IntraSnake Free Spots: {{intraSnakeFreeSpot.length}}
            <br/> {{intraSnakeFreeSpot}}
            <br/>
            <br/> InterSnake Free Spots: {{interSnakeFreeSpot.length}}
            <br/> {{interSnakeFreeSpot}}
        </div>
    </div>
</div>


<script>
    var cleanArray = function (actual) {
        var newArray = new Array();
        for (var i = 0; i < actual.length; i++) {
            if (actual[i]) {
                newArray.push(actual[i]);
            }
        }
        return newArray;
    };
    var snakesAsInt = function (snakesStr) {
        var snakes = new Array();
        for (let i = 0; i < snakesStr.length; i++) {
            var strSnake = snakesStr[i].split('-');
            var intSnake = new Array();
            for (let j = 0; j < strSnake.length; j++) {
                intSnake.push(Number(strSnake[j]));
            }
            snakes.push(intSnake);
        }
        return snakes;
    };
    var validDim = function (snakes, dim) {
        let valid = true;
        let maxDimValue = Math.pow(2, dim);
        for (let i = 0; i < snakes.length && valid; i++) {
            for (let j = 0; j < snakes[i].length && valid; j++) {
                valid = snakes[i][j] < maxDimValue;
            }
        }
        return valid;
    };
    const hammingDistance = (x, y) => {
        let val = x ^ y;
        let distance;
        for (distance = 0; val > 0; distance++) {
            val &= val - 1;
        }
        return distance;
    };
    var validSnakes = function (snakes) {
        let valid = true;
        let maxDimValue = Math.pow(2, dim);
        for (let i = 0; i < snakes.length && valid; i++) {
            for (let j = 0; j < snakes[i].length-1 && valid; j++) {
                valid = hammingDistance(snakes[i][j], snakes[i][j+1])==1;
            }
        }
        return valid;
    };
    var app = new Vue({
        el: '#app'
        , data: {
            snakeSpread: 2
            , boxSpread: 3
            , dim: 4
            , sequance: '|0|5|'
            , snakeSpot: new Array()
            , intraSnakeFreeSpot: new Array()
            , interSnakeFreeSpot: new Array()
        }
        , methods: {
            calculateFreeSpots: function () {
                this.snakeSpot = new Array()
                this.intraSnakeFreeSpot = new Array()
                this.interSnakeFreeSpot = new Array()
                let maxDimValue = Math.pow(2, this.dim);
                var partsOfStr = this.sequance.split('|');
                var cleaned = cleanArray(partsOfStr);
                if (cleaned.length == 0) {
                    alert('no input');
                    return;
                }
                var snakes = snakesAsInt(cleaned);
                if (!validDim(snakes, this.dim)) {
                    alert('dimentions error');
                    return;
                }
                if (!validSnakes(snakes)) {
                    alert('snakes are invalid!');
                    return;
                }
                for (let loc = 0; loc < maxDimValue; loc++) {
                    let locFound = false;
                    let allIntraHammingGood = true;
                    let allInterHammingGood = true;
                    for (let i = 0; i < snakes.length && !locFound; i++) {
                        for (let j = 0; j < snakes[i].length && !locFound; j++) {
                            if (loc == snakes[i][j]) {
                                this.snakeSpot.push(loc);
                                locFound = true;
                            }
                            else {
                                let distance = hammingDistance(loc, snakes[i][j]);
                                if (this.snakeSpread > distance) {
                                    allIntraHammingGood = false;
                                }
                                if (this.boxSpread > distance) {
                                    allInterHammingGood = false;
                                }
                            }
                        }
                    }
                    if (!locFound && allIntraHammingGood) {
                        this.intraSnakeFreeSpot.push(loc);
                    }
                    if (!locFound && allInterHammingGood) {
                        this.interSnakeFreeSpot.push(loc);
                    }
                }
            }
        }
    });
</script>